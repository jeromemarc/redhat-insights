/* [create-plugin] version: 5.3.7 */
define(["@grafana/data","@grafana/runtime","@grafana/ui","lodash","module","react","rxjs"],((e,t,r,n,o,a,i)=>(()=>{var s={2781:(e,t,r)=>{var n=r(1433).Symbol;e.exports=n},6701:e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},1163:(e,t,r)=>{var n=r(6204),o=r(1256),a=r(6397),i=r(492),s=r(2845),u=r(7995),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=a(e),p=!r&&o(e),l=!r&&!p&&i(e),y=!r&&!p&&!l&&u(e),d=r||p||l||y,f=d?n(e.length,String):[],b=f.length;for(var v in e)!t&&!c.call(e,v)||d&&("length"==v||l&&("offset"==v||"parent"==v)||y&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,b))||f.push(v);return f}},7148:(e,t,r)=>{var n=r(2781),o=r(7903),a=r(1738),i=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):a(e)}},9250:(e,t,r)=>{var n=r(7148),o=r(2934);e.exports=function(e){return o(e)&&"[object Arguments]"==n(e)}},6567:(e,t,r)=>{var n=r(8446),o=r(8092),a=r(8953),i=r(1485),s=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,p=u.toString,l=c.hasOwnProperty,y=RegExp("^"+p.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||o(e))&&(n(e)?y:s).test(i(e))}},7129:(e,t,r)=>{var n=r(7148),o=r(3330),a=r(2934),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&o(e.length)&&!!i[n(e)]}},1491:(e,t,r)=>{var n=r(8953),o=r(7499),a=r(8201),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return a(e);var t=o(e),r=[];for(var s in e)("constructor"!=s||!t&&i.call(e,s))&&r.push(s);return r}},1506:(e,t,r)=>{var n=r(4796),o=r(5265),a=r(6805);e.exports=function(e,t){return a(o(e,t,n),e+"")}},7310:(e,t,r)=>{var n=r(3122),o=r(8559),a=r(4796),i=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:a;e.exports=i},6204:e=>{e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},41:e=>{e.exports=function(e){return function(t){return e(t)}}},8109:(e,t,r)=>{var n=r(1433)["__core-js_shared__"];e.exports=n},8559:(e,t,r)=>{var n=r(9138),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},5380:(e,t,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=n},9138:(e,t,r)=>{var n=r(6567),o=r(6772);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},7903:(e,t,r)=>{var n=r(2781),o=Object.prototype,a=o.hasOwnProperty,i=o.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=a.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var o=i.call(e);return n&&(t?e[s]=r:delete e[s]),o}},6772:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},2845:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var n=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<r}},6220:(e,t,r)=>{var n=r(9316),o=r(8330),a=r(2845),i=r(8953);e.exports=function(e,t,r){if(!i(r))return!1;var s=typeof t;return!!("number"==s?o(r)&&a(t,r.length):"string"==s&&t in r)&&n(r[t],e)}},8092:(e,t,r)=>{var n,o=r(8109),a=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!a&&a in e}},7499:e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},8201:e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},3685:(e,t,r)=>{e=r.nmd(e);var n=r(5380),o=t&&!t.nodeType&&t,a=o&&e&&!e.nodeType&&e,i=a&&a.exports===o&&n.process,s=function(){try{var e=a&&a.require&&a.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=s},1738:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},5265:(e,t,r)=>{var n=r(6701),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var a=arguments,i=-1,s=o(a.length-t,0),u=Array(s);++i<s;)u[i]=a[t+i];i=-1;for(var c=Array(t+1);++i<t;)c[i]=a[i];return c[t]=r(u),n(e,this,c)}}},1433:(e,t,r)=>{var n=r(5380),o="object"==typeof self&&self&&self.Object===Object&&self,a=n||o||Function("return this")();e.exports=a},6805:(e,t,r)=>{var n=r(7310),o=r(3983)(n);e.exports=o},3983:e=>{var t=Date.now;e.exports=function(e){var r=0,n=0;return function(){var o=t(),a=16-(o-n);if(n=o,a>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},1485:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},3122:e=>{e.exports=function(e){return function(){return e}}},3936:(e,t,r)=>{var n=r(1506),o=r(9316),a=r(6220),i=r(5405),s=Object.prototype,u=s.hasOwnProperty,c=n((function(e,t){e=Object(e);var r=-1,n=t.length,c=n>2?t[2]:void 0;for(c&&a(t[0],t[1],c)&&(n=1);++r<n;)for(var p=t[r],l=i(p),y=-1,d=l.length;++y<d;){var f=l[y],b=e[f];(void 0===b||o(b,s[f])&&!u.call(e,f))&&(e[f]=p[f])}return e}));e.exports=c},9316:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},4796:e=>{e.exports=function(e){return e}},1256:(e,t,r)=>{var n=r(9250),o=r(2934),a=Object.prototype,i=a.hasOwnProperty,s=a.propertyIsEnumerable,u=n(function(){return arguments}())?n:function(e){return o(e)&&i.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},6397:e=>{var t=Array.isArray;e.exports=t},8330:(e,t,r)=>{var n=r(8446),o=r(3330);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},492:(e,t,r)=>{e=r.nmd(e);var n=r(1433),o=r(659),a=t&&!t.nodeType&&t,i=a&&e&&!e.nodeType&&e,s=i&&i.exports===a?n.Buffer:void 0,u=(s?s.isBuffer:void 0)||o;e.exports=u},8446:(e,t,r)=>{var n=r(7148),o=r(8953);e.exports=function(e){if(!o(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},3330:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},8953:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},2934:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},7995:(e,t,r)=>{var n=r(7129),o=r(41),a=r(3685),i=a&&a.isTypedArray,s=i?o(i):n;e.exports=s},5405:(e,t,r)=>{var n=r(1163),o=r(1491),a=r(8330);e.exports=function(e){return a(e)?n(e,!0):o(e)}},659:e=>{e.exports=function(){return!1}},7781:t=>{"use strict";t.exports=e},8531:e=>{"use strict";e.exports=t},2007:e=>{"use strict";e.exports=r},3241:e=>{"use strict";e.exports=n},1308:e=>{"use strict";e.exports=o},5959:e=>{"use strict";e.exports=a},1269:e=>{"use strict";e.exports=i}},u={};function c(e){var t=u[e];if(void 0!==t)return t.exports;var r=u[e]={id:e,loaded:!1,exports:{}};return s[e](r,r.exports,c),r.loaded=!0,r.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),c.p="public/plugins/red-hat-insights/";var p={};return(()=>{"use strict";c.r(p),c.d(p,{plugin:()=>T});var e=c(1308),t=c.n(e);c.p=t()&&t().uri?t().uri.slice(0,t().uri.lastIndexOf("/")+1):"public/plugins/red-hat-insights/";var r=c(7781),n=c(2007),o=c(5959),a=c.n(o);var i=c(8531),s=c(3241),u=c.n(s),l=c(3936),y=c.n(l);const d={};var f=c(1269);function b(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function v(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){b(a,n,o,i,s,"next",e)}function s(e){b(a,n,o,i,s,"throw",e)}i(void 0)}))}}class g extends r.DataSourceApi{query(e){var t=this;return v((function*(){const n=e.targets.map((o=v((function*(e){const n=y()(e,d);let o="/api/insights/v1/export/hits/";switch(n.queryText){case"inventory":o="/api/inventory/v1/hosts";break;case"vulnerability":o="/api/vulnerability/v1/vulnerabilities/cves?affecting=true";break;case"compliance":o="/api/compliance/v1/profiles";break;case"patch":o="/api/patch/v1/advisories/";break;default:o="/api/insights/v1/export/hits/"}const a=yield t.request(o,"");let i=JSON.parse(JSON.stringify(a.data)),s=new r.MutableDataFrame;switch(n.queryText){case"inventory":i=JSON.parse(JSON.stringify(a.data.results)),s=new r.MutableDataFrame({refId:n.refId,fields:[{name:"fqdn",type:r.FieldType.string},{name:"insights_id",type:r.FieldType.string},{name:"id",type:r.FieldType.string},{name:"display_name",type:r.FieldType.string},{name:"reporter",type:r.FieldType.string}]});for(let e=0;e<i.length;e++)s.appendRow([i[e].fqdn,i[e].insights_id,i[e].id,i[e].display_name,i[e].reporter]);break;case"vulnerability":i=JSON.parse(JSON.stringify(a.data.data)),s=new r.MutableDataFrame({refId:n.refId,fields:[{name:"id",type:r.FieldType.string},{name:"type",type:r.FieldType.string},{name:"description",type:r.FieldType.string},{name:"impact",type:r.FieldType.string},{name:"systems_affected",type:r.FieldType.number}]});for(let e=0;e<i.length;e++)s.appendRow([i[e].id,i[e].type,i[e].attributes.description,i[e].attributes.impact,i[e].attributes.systems_affected]);break;case"compliance":i=JSON.parse(JSON.stringify(a.data.data)),s=new r.MutableDataFrame({refId:n.refId,fields:[{name:"id",type:r.FieldType.string},{name:"type",type:r.FieldType.string},{name:"name",type:r.FieldType.string},{name:"description",type:r.FieldType.string},{name:"policy_profile_id",type:r.FieldType.string},{name:"total_host_count",type:r.FieldType.number},{name:"compliant_host_count",type:r.FieldType.number}]});for(let e=0;e<i.length;e++)s.appendRow([i[e].id,i[e].type,i[e].attributes.name,i[e].attributes.description,i[e].attributes.policy_profile_id,i[e].attributes.total_host_count,i[e].attributes.compliant_host_count]);break;case"patch":i=JSON.parse(JSON.stringify(a.data.data)),s=new r.MutableDataFrame({refId:n.refId,fields:[{name:"id",type:r.FieldType.string},{name:"type",type:r.FieldType.string},{name:"synopsis",type:r.FieldType.string},{name:"description",type:r.FieldType.string},{name:"advisory_type_name",type:r.FieldType.string},{name:"cve_count",type:r.FieldType.number},{name:"applicable_systems",type:r.FieldType.number}]});for(let e=0;e<i.length;e++)s.appendRow([i[e].id,i[e].type,i[e].attributes.synopsis,i[e].attributes.description,i[e].attributes.advisory_type_name,i[e].attributes.cve_count,i[e].attributes.applicable_systems]);break;default:s=new r.MutableDataFrame({refId:n.refId,fields:[{name:"hostname",type:r.FieldType.string},{name:"recommendation",type:r.FieldType.string},{name:"rhel_version",type:r.FieldType.string},{name:"total_risk",type:r.FieldType.number},{name:"likelihood",type:r.FieldType.number},{name:"uuid",type:r.FieldType.string},{name:"results_url",type:r.FieldType.string}]});for(let e=0;e<i.length;e++)s.appendRow([i[e].hostname,i[e].title,i[e].rhel_version,i[e].total_risk,i[e].likelihood,i[e].uuid,i[e].results_url])}return s})),function(e){return o.apply(this,arguments)}));var o;return Promise.all(n).then((e=>({data:e})))}))()}request(e,t){var r=this;return v((function*(){const n=(0,i.getBackendSrv)().fetch({url:`${r.baseUrl}${e}${(null==t?void 0:t.length)?`?${t}`:""}`});return(0,f.lastValueFrom)(n)}))()}testDatasource(){var e=this;return v((function*(){const t="Cannot connect to API";try{const r=yield e.request("/api/insights/v1/");return 200===r.status?{status:"success",message:"Success"}:{status:"error",message:r.statusText?r.statusText:t}}catch(e){let r="";return u().isString(e)?r=e:(0,i.isFetchError)(e)&&(r+=e.statusText?e.statusText:t,e.data&&e.data.error&&e.data.error.code&&(r+=": "+e.data.error.code+". "+e.data.error.message)),{status:"error",message:r}}}))()}constructor(e){var t,r,n;super(e),n=void 0,(r="baseUrl")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,this.baseUrl=e.url}}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){m(e,t,r[t])}))}return e}function x(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const{FormField:j}=n.LegacyForms;class O extends o.PureComponent{render(){const e=y()(this.props.query,d),{queryText:t}=e;return a().createElement("div",null,a().createElement(j,{labelWidth:8,value:t||"advisor",onChange:this.onQueryTextChange,label:"Query",tooltip:"Currently implemented are advisor, compliance, inventory, patch and vulnerability"}))}constructor(...e){super(...e),m(this,"onQueryTextChange",(e=>{const{onChange:t,query:r}=this.props;t(x(h({},r),{queryText:e.target.value}))})),m(this,"onConstantChange",(e=>{const{onChange:t,query:r,onRunQuery:n}=this.props;t(h({},r)),n()}))}}const T=new r.DataSourcePlugin(g).setConfigEditor((({onOptionsChange:e,options:t})=>a().createElement(n.DataSourceHttpSettings,{defaultUrl:"https://console.redhat.com",dataSourceConfig:t,onChange:e}))).setQueryEditor(O)})(),p})()));
//# sourceMappingURL=module.js.map